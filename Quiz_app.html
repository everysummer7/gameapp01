<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圖片快問快答 App</title>
    <!-- 載入 Tailwind CSS CDN for modern and responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 設定 Inter 字體和 Tailwind 配置 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* 淺灰色背景 */
        }
        /* 自定義按鈕動畫 */
        .quiz-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px #4b5563; /* 初始陰影 */
        }
        .quiz-button:active {
            box-shadow: 0 2px #4b5563; /* 點擊時縮小陰影 */
            transform: translateY(2px);
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- 主應用程式容器 (最大寬度限制，確保手機上的良好體驗) -->
    <div id="app" class="w-full max-w-md bg-white rounded-xl shadow-2xl p-6 md:p-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6 border-b pb-3">
            圖片快問快答
        </h1>

        <!-- Quiz 介面 -->
        <div id="quiz-container">
            <!-- 圖片區域 -->
            <div class="mb-6 rounded-lg overflow-hidden border border-gray-200 shadow-lg">
                <!-- 圖片載入錯誤時的備用圖 -->
                <img id="question-image" src="" alt="問題相關圖片" class="w-full h-48 object-cover bg-gray-100" onerror="this.src='https://placehold.co/600x400/ccc/333?text=圖片載入失敗';" />
            </div>

            <!-- 問題標題 -->
            <p id="question-text" class="text-xl font-semibold text-gray-700 mb-4 min-h-[50px]">
                載入中...
            </p>

            <!-- 進度顯示 -->
            <div class="text-sm text-gray-500 mb-6 flex justify-between">
                <!-- 進度顯示現在會顯示 X / 5 -->
                <span id="progress-text">問題 1 / 5</span> 
                <span id="score-text">分數: 0</span>
            </div>
            
            <!-- 選項按鈕容器 -->
            <div id="options-container" class="space-y-4">
                <!-- 選項按鈕將由 JavaScript 注入 -->
            </div>
        </div>

        <!-- 結果/模態視窗容器 -->
        <div id="result-container" class="hidden text-center">
            <h2 id="final-message" class="text-3xl font-bold text-blue-600 mb-4"></h2>
            <p id="final-score-text" class="text-xl text-gray-700 mb-2"></p>
            <!-- 新增顯示遊玩時間的元素 -->
            <p id="time-spent-text" class="text-lg font-medium text-gray-600 mb-8"></p> 
            <button onclick="resetQuiz()" class="w-full quiz-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transform hover:scale-[1.02] active:scale-[0.98]">
                重新開始測驗
            </button>
        </div>

        <!-- 訊息模態 (取代 alert) -->
        <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs transform scale-100 transition-transform duration-300">
                <h3 id="modal-title" class="text-xl font-bold mb-3 text-gray-800"></h3>
                <p id="modal-message" class="text-gray-600 mb-4"></p>
                <button onclick="document.getElementById('message-modal').classList.add('hidden')" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg">
                    確定
                </button>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // 核心洗牌函式 (Fisher-Yates 演算法)
        // =================================================================
        function shuffleArray(array) {
            // 複製陣列以避免修改原始資料
            const newArray = [...array]; 
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // =================================================================
        // 測驗資料：總題庫 (模擬 50 題，您可以替換為自己的 50 個問題)
        // =================================================================
        const fullQuizData = [];
        
        // 基礎問題模板 (用於生成 50 個不同的問題)
        // **如何設定圖片:** 將 "img" 欄位中的網址替換成您自己的圖片連結即可。
        const baseQuestions = [
            { q: "以下照片沒有什麼缺失？", img: "https://www.ilosh.gov.tw/media/3hrj2lrs/3.jpg?width=464&height=289", opts: ["未戴安全帽", "未穿著背負式安全帶", "未穿著上衣", "施工未站立於平台"], ans: "未戴安全帽" },
            { q: "以下照片沒有什麼缺失？", img: "https://www.ilosh.gov.tw/media/2tlp5l4z/4.jpg?width=475&height=293", opts: ["未戴安全帽", "未穿著背負式安全帶", "未穿著安全鞋", "無缺失"], ans: "無缺失" },
            { q: "為什麼要配戴安全帽？", img: "https://cc.tvbs.com.tw/img/upload/2020/05/31/20200531113813-1404dacd.jpg", opts: ["防止頭部撞傷", "防止腳步撞傷", "防止手部撞傷", "防止膝蓋撞傷"], ans: "防止頭部撞傷" },
            { q: "如果維修保養中沒有掛上告示牌，下列何者不正確？", img: "https://resize-image.vocus.cc/resize?compression=6&norotation=true&url=https%3A%2F%2Fimages.vocus.cc%2Ff7d6c1ed-0dd9-4232-bdc8-eaf15ba6237a.png&width=740&sign=N0MG0z0CocTn-r9AWT1gSQgRcCxJyChA3BVihdeyJyM", opts: ["誤觸開關", "機台運作", "導致人員傷亡", "無任何影響"], ans: "無任何影響" },
            { q: "以下何者狀況不會容易導致觸電發生？", img: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.zygsz.com%2Farticle-detail%2FbV4zOlYN&psig=AOvVaw3sN5rmpeK61T-kWrqYEj6E&ust=1761275085102000&source=images&cd=vfe&opi=89978449&ved=0CBUQjRxqFwoTCLDSipCruZADFQAAAAAdAAAAABAE", opts: ["手部潮濕觸碰插座", "在浴室吹頭髮", "插座堆積灰塵", "插座定期檢測"], ans: "插座定期檢測" },

        ];

        // 循環生成 50 題 (每個基礎題重複 5 次，但圖片和問題編號會變動)
        for (let i = 0; i < 50; i++) {
            const base = baseQuestions[i % baseQuestions.length];
            fullQuizData.push({
                question: `[第 ${i + 1} 號變體] ${base.q}`,
                image: base.img, // 直接使用 base.img 中的圖片網址
                options: [...base.opts], // 複製選項陣列
                answer: base.ans
            });
        }
        
        // 應用程式狀態
        let currentQuestionIndex = 0;
        let score = 0;
        const QUESTIONS_PER_SESSION = 5; // 每次測驗只出 5 題
        let sessionQuestions = [];      // 當前測驗會使用的 5 題
        let totalQuestions = QUESTIONS_PER_SESSION;
        
        // 計時器相關變數
        let startTime = null;
        let endTime = null;

        // 取得 DOM 元素
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const questionText = document.getElementById('question-text');
        const questionImage = document.getElementById('question-image');
        const optionsContainer = document.getElementById('options-container');
        const progressText = document.getElementById('progress-text');
        const scoreText = document.getElementById('score-text');
        const finalMessage = document.getElementById('final-message');
        const finalScoreText = document.getElementById('final-score-text');
        const timeSpentText = document.getElementById('time-spent-text'); 
        const messageModal = document.getElementById('message-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');

        /**
         * 顯示自定義訊息模態，取代 alert()
         */
        function showModal(title, message, isSuccess = true) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.classList.toggle('text-green-600', isSuccess);
            modalTitle.classList.toggle('text-red-600', !isSuccess);
            messageModal.classList.remove('hidden');
        }

        /**
         * 載入並渲染當前問題
         */
        function loadQuestion() {
            // 現在從 sessionQuestions 陣列中獲取問題
            if (currentQuestionIndex >= totalQuestions) { 
                showResult();
                return;
            }

            const q = sessionQuestions[currentQuestionIndex];
            
            // 將選項洗牌，確保每次問題出現時選項順序都不同
            const shuffledOptions = shuffleArray(q.options); 
            
            // 更新文字和圖片
            questionText.textContent = `${currentQuestionIndex + 1}. ${q.question}`;
            questionImage.src = q.image;

            // 更新進度和分數 (總題數固定為 5)
            progressText.textContent = `問題 ${currentQuestionIndex + 1} / ${totalQuestions}`;
            scoreText.textContent = `分數: ${score}`;
            
            // 清空舊選項
            optionsContainer.innerHTML = '';

            // 創建新的選項按鈕
            shuffledOptions.forEach((option) => {
                const button = document.createElement('button');
                button.textContent = option;
                // 應用 Tailwind 樣式，確保響應性和美觀
                button.className = 'quiz-button w-full bg-indigo-500 text-white text-lg font-semibold py-3 px-4 rounded-lg hover:bg-indigo-600 active:bg-indigo-700 shadow-lg';
                button.onclick = () => checkAnswer(option, button);
                optionsContainer.appendChild(button);
            });
        }

        /**
         * 檢查答案並進行處理
         */
        function checkAnswer(selectedOption, button) {
            const currentQuestion = sessionQuestions[currentQuestionIndex];
            const isCorrect = selectedOption === currentQuestion.answer;
            
            // 暫時禁用所有按鈕，防止重複點擊
            Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);

            if (isCorrect) {
                score++;
                // 正確動畫：變綠
                button.classList.add('bg-green-500', 'shadow-green-700', 'animate-pulse');
                showModal('恭喜!', '答案正確! 加一分。', true);
            } else {
                // 錯誤動畫：變紅
                button.classList.add('bg-red-500', 'shadow-red-700', 'animate-shake');
                showModal('錯誤', `答案是錯的。正確答案是: ${currentQuestion.answer}`, false);
            }

            // 尋找並標記正確答案 (如果選錯的話)
            if (!isCorrect) {
                Array.from(optionsContainer.children).forEach(btn => {
                    if (btn.textContent === currentQuestion.answer) {
                        btn.classList.add('bg-green-400', 'shadow-green-600');
                    }
                });
            }

            // 延遲一段時間後切換到下一個問題
            setTimeout(() => {
                // 移除所有按鈕的特殊顏色和動畫
                Array.from(optionsContainer.children).forEach(btn => {
                    btn.classList.remove('bg-green-500', 'shadow-green-700', 'animate-pulse', 'bg-red-500', 'shadow-red-700', 'animate-shake', 'bg-green-400', 'shadow-green-600');
                    btn.classList.add('bg-indigo-500'); // 恢復預設顏色
                });

                currentQuestionIndex++;
                loadQuestion();

                // 重新啟用按鈕 (在 loadQuestion 中處理，但為了安全再次啟用)
                Array.from(optionsContainer.children).forEach(btn => btn.disabled = false);

            }, 1200); // 1.2 秒延遲
        }

        /**
         * 格式化毫秒為總秒數 (含小數點) 的字串
         * * 更新: 現在只顯示總秒數，精確到小數點後一位。
         */
        function formatTime(ms) {
            // 計算總秒數，並四捨五入到小數點後一位 (代表十分之一秒)
            const totalSecondsWithTenths = (ms / 1000).toFixed(1); 
            
            // 返回總秒數，例如: "95.2 秒"
            return `${totalSecondsWithTenths} 秒`;
        }

        /**
         * 顯示最終結果
         */
        function showResult() {
            // 停止計時
            endTime = new Date();
            const timeDiff = endTime - startTime; // 總花費時間（毫秒）

            quizContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');

            const percentage = (score / totalQuestions) * 100;

            let message = '';
            if (percentage === 100) {
                message = '完美! 您是快問快答大師!';
            } else if (percentage >= 60) {
                message = '表現優秀! 繼續保持。';
            } else {
                message = '下次會更好! 需要多加練習喔。';
            }

            finalMessage.textContent = message;
            finalScoreText.textContent = `您的最終分數是 ${score} 題答對，共 ${totalQuestions} 題。`;
            // 使用更新後的 formatTime 函式
            timeSpentText.textContent = `總遊玩時間: ${formatTime(timeDiff)}`; 
        }

        /**
         * 重設測驗狀態並開始
         */
        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            
            // 1. 洗牌整個題庫
            const shuffledFullData = shuffleArray(fullQuizData);
            
            // 2. 選擇前 5 題作為本次測驗的題目
            sessionQuestions = shuffledFullData.slice(0, QUESTIONS_PER_SESSION);
            totalQuestions = QUESTIONS_PER_SESSION; // 確保總題數是 5

            // 啟動計時
            startTime = new Date(); 
            endTime = null;

            quizContainer.classList.remove('hidden');
            resultContainer.classList.add('hidden');
            loadQuestion();
        }

        // 啟動應用程式
        window.onload = resetQuiz;
    </script>
</body>
</html>
