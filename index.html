<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圖片快問快答 App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

<div id="app" class="w-full max-w-md bg-white rounded-xl shadow-2xl p-6 md:p-8">
<!-- 工號 + 廠區輸入畫面 -->
<div id="id-container" class="text-center">

    <!-- 新增的 1920x1080 圖片 -->
    <img src="https://lh3.googleusercontent.com/pw/AP1GczNLiF46UYA9jN8VsHkhzUGXxxv7iV4fvaOuyKCvK3BfuLlmIGci9lP-WfeC9Pum4VxcBJSBC4x7f_4ljR5Vs2XoKAXOYJy6tu-6FQGFby-HuLwh3RMWmNInKiIdYyx7oLBiAJeRFQCyOpjXiv1Y9HLO=w1657-h932-s-no?authuser=0"
         class="w-full rounded-lg mb-6"
         style="max-height: 320px; object-fit: cover;">

    <h2 class="text-2xl font-bold text-gray-700 mb-4">請選擇廠區</h2>

        <div class="flex justify-around mb-6">
            <label><input type="radio" name="site" value="BMC" class="mr-2">BMC</label>
            <label><input type="radio" name="site" value="BML" class="mr-2">BML</label>
            <label><input type="radio" name="site" value="BMY" class="mr-2">BMY</label>
        </div>

        <h2 class="text-2xl font-bold text-gray-700 mb-4">請輸入您的工號</h2>
        <input id="employee-id" type="number"
            class="border border-gray-300 rounded-lg p-3 w-full mb-4 text-center"
            placeholder="僅限數字" required />

        <button onclick="startQuiz()" 
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg">
            開始遊戲
        </button>
    </div>

    <!-- Quiz 介面 -->
    <div id="quiz-container" class="hidden">
        <div class="mb-6 rounded-lg overflow-hidden border border-gray-200 shadow-lg">
            <img id="question-image" src="" class="w-full h-48 object-cover bg-gray-100" />
        </div>
        <p id="question-text" class="text-xl font-semibold text-gray-700 mb-4"></p>
        <div class="text-sm text-gray-500 mb-6 flex justify-between">
            <span id="progress-text">問題 1 / 5</span>
            <span id="score-text">分數: 0</span>
        </div>
        <div id="options-container" class="space-y-4"></div>
    </div>

    <!-- 結果畫面 -->
    <div id="result-container" class="hidden text-center">
    <!-- 測驗完成頁面的圖片 -->
    <img src="https://lh3.googleusercontent.com/pw/AP1GczNLiF46UYA9jN8VsHkhzUGXxxv7iV4fvaOuyKCvK3BfuLlmIGci9lP-WfeC9Pum4VxcBJSBC4x7f_4ljR5Vs2XoKAXOYJy6tu-6FQGFby-HuLwh3RMWmNInKiIdYyx7oLBiAJeRFQCyOpjXiv1Y9HLO=w1657-h932-s-no?authuser=0"
         class="w-full rounded-lg mb-6"
         style="max-height: 300px; object-fit: cover;">

    <h2 id="final-message" class="text-3xl font-bold text-blue-600 mb-4"></h2>
        <h2 id="final-message" class="text-3xl font-bold text-blue-600 mb-4"></h2>
            <!-- 新增：顯示廠區與工號 -->
    <p id="final-site" class="text-lg text-gray-700 mb-1"></p>
    <p id="final-id" class="text-lg text-gray-700 mb-4"></p>
        <p id="final-score-text" class="text-xl text-gray-700 mb-2"></p>
        <p id="time-spent-text" class="text-lg font-medium text-gray-600 mb-8"></p>

        <button onclick="resetQuiz()" 
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg">
            重新開始測驗
        </button>
    </div>
</div>

<!-- Netlify 隱藏表單 -->
<form name="quiz-results" netlify netlify-honeypot="bot-field" hidden>
    <input type="text" name="site">
    <input type="text" name="employee_id">
    <input type="number" name="score">
    <input type="number" name="time_spent">
    <input type="text" name="timestamp">
    <input type="text" name="ip">
</form>

<!-- 訊息彈跳視窗 -->
<div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs">
        <h3 id="modal-title" class="text-xl font-bold mb-3 text-center"></h3>
        <p id="modal-message" class="text-gray-700 mb-4 text-center"></p>
        <button id="modal-ok" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg">
            確定
        </button>
    </div>
</div>

<script>
    function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

const fullQuizData = [
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHeidkStm0_1PxF8jzYfqah_jpVuRDNFJ5vMQtMcGwePyxceDK22YMqAO38neSWGDRbMpGvYjIEsN0o3LVaRbTIvgCOdNbaque4UYOy3dlkhO_6LQynCfHuWgJ0C1shZVvm_P6WZ1Ft8VdFLgPqRvG0=w1864-h932-s-no-gm?authuser=0",
    options: ["擠壓瓶GHS髒污無法辨識", "滅火器遭阻擋", "插座髒污", "電器合格標籤過期"],
    answer: "滅火器遭阻擋"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHdExb_CMNVKKEkLBGLoTV97Kc8it0b0OPJzZLUF84x_I19MjY41vzv308QVbqpjbAdBfQnd5x3KizZuBTwE0kkdG-i1VMRE5vaI9opQXalmh_Tz5bgP4y4xabbbcnE7gMIEsAJcbbbYJiArP_H4BL4=w1864-h932-s-no-gm?authuser=0",
    options: ["擠壓瓶GHS髒污無法辨識", "滅火器遭阻擋", "插座髒污", "電器合格標籤過期"],
    answer: "擠壓瓶GHS髒污無法辨識"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHcJdpWA_qE0Xdij_3fmpRL_nRw3lROFV14RtLoMbYLS8VoedYVH6Qkb8VZGwYjn3voC0dgzTRHjO6E2G3gvZvAP0FMmZ5etqdNPYoxPNJSxqrDqaC_JXRwVPYdeQH-RlSj6-fZSxlN6oVSJvSrr6r4=w1864-h932-s-no-gm?authuser=0",
    options: ["擠壓瓶GHS髒污無法辨識", "滅火器遭阻擋", "插座髒污", "電器合格標籤過期"],
    answer: "電器合格標籤過期"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHcxg7SNanloFH-3F4nSgEULh-o1RvNTJM1PzzbS-aZ_cGhAmP-MLs1n7q9jj5GhOhevaeh7vexeJmk15C866I5TKPb6O9T19eUbA_Bw5WoA4bBRp2qkVvloKp4kSss6mRlxY1qtKYu-arv4mxL6Py0=w1864-h932-s-no-gm?authuser=0",
    options: ["擠壓瓶GHS髒污無法辨識", "滅火器遭阻擋", "插座髒污", "電器合格標籤過期"],
    answer: "插座髒污"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHchv4TnAVrM1M93naaXh1kz2b7wtAbdpkMLpOf5qlZxj2HZVA7XmxKugmZZUqg0xkHTa7ObXJSKn7ZCIqRo1RFUJ3anWYnJ0JQv1179CZAjTt-r0JhtGmE1Su6GdAKYuqJJNE_oR7xSPHlCJkGADzk=w1864-h932-s-no-gm?authuser=0",
    options: ["鋼瓶不正確固定", "鋼瓶未使用未蓋鋼瓶帽", "鋼瓶SDS過期", "無缺失"],
    answer: "鋼瓶不正確固定"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHf2G4S9iKHqMpb3VILBJv6lxFZbHljgdrPqf1ZTf3o6MPHp9KE3r5N7gYSotQEhNTxiLjaaYpMPTXljuQ5L1Dwo9c3TkKNWVOiKmiHkFuwOEzOFUC2ApWpXEaknu1C7xht56t9FbUzG9zDa13oL2JM=w1864-h932-s-no-gm?authuser=0",
    options: ["鋼瓶不正確固定", "鋼瓶未使用未蓋鋼瓶帽", "鋼瓶SDS過期", "無缺失"],
    answer: "鋼瓶未使用未蓋鋼瓶帽"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHezz0ue3S0tn_0hm-k7f5_HYgxeuYxE18UEp2ENXr9K0CNmOGOIKZMwbVYy3w1fMxL0FzAW_ToFxgrTH-4VE8KrW5rB1plFmzBPTAnzIKkO5gq8pBPqlbOYelmkI4mPLP3oR_M-8au9c-rTyGy4gCM=w1864-h932-s-no-gm?authuser=0",
    options: ["緊急出口動線遭阻", "緊急出口燈未亮", "緊急出口未標示", "無缺失"],
    answer: "緊急出口動線遭阻"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHd5V7oqHat5Ff1bzH4UzCn4TQJLP3GXZ2wtvA4PaEcXKDDfFjYmJx4K6ieOyMfWvapJGox6ETmBAHxtG686z3cjgKf3vzab-hUj27xXh40euufkM8JbTgOxiVeDwFbwNyChrPmL8NLvJr_KbhZZwGo=w1864-h932-s-no-gm?authuser=0",
    options: ["緊急出口動線遭阻", "緊急出口燈未亮", "緊急出口未標示", "無缺失"],
    answer: "緊急出口燈未亮"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHcLPxOu2DcBbpYpM4J7MAZFdECOldy6SrRAIxnOOzKvH--HQ8dMGVkgLPWhaLJHaQMhJAuebjkO8zySkIhFDEeKITJ50Igqa2zCtdzBH4THAeDdCN8rgF96cX2k19fJlOj4fzQvGr3L-aBXV4PYt9c=w1864-h932-s-no-gm?authuser=0",
    options: ["緊急沖身區故障", "緊急沖身區不應堆放雜物", "緊急沖身區未點檢", "無缺失"],
    answer: "緊急沖身區不應堆放雜物"
  },
  {
    question: "請問照片中有什麼缺失？",
    image: "https://photos.fife.usercontent.google.com/pw/ADCreHd0zZ0xdnc06JEMCDlupj3cPMFtC_1AhYCmoGQVVVUD5UxEhY2fks-e-iWcXn-2DqTdssRBHq2wTLHzv8mRkeV2pYvP0msDcph1wu6J41F5JHrbtf1lKZeW3uDPfJV-ptpSLZlYzFj1gnJ3v-mPm70=w1864-h932-s-no-gm?authuser=0",
    options: ["緊急排煙裝置按鈕故障", "緊急排煙裝置按鈕遭阻擋", "緊急排煙裝置按鈕未設置", "無缺失"],
    answer: "緊急排煙裝置按鈕遭阻擋"
  },
];
    let siteValue = null;
    let employeeId = null;
    let currentQuestionIndex = 0;
    let score = 0;
    const QUESTIONS_PER_SESSION = 5;
    let sessionQuestions = [];
    let startTime = null;

    function startQuiz() {
        const siteRadio = document.querySelector("input[name='site']:checked");
        const idValue = document.getElementById('employee-id').value.trim();

        if (!siteRadio) return alert("請選擇廠區");
        if (!idValue || isNaN(idValue)) return alert("請輸入有效工號");

        siteValue = siteRadio.value;
        employeeId = idValue;

        document.getElementById('id-container').classList.add('hidden');
        resetQuiz();
    }

    function loadQuestion() {
        if (currentQuestionIndex >= QUESTIONS_PER_SESSION) {
            showResult();
            return;
        }

        const q = sessionQuestions[currentQuestionIndex];
        const shuffled = shuffleArray(q.options);

        document.getElementById('question-text').textContent =
            `${currentQuestionIndex + 1}. ${q.question}`;
        document.getElementById('question-image').src = q.image;
        document.getElementById('progress-text').textContent =
            `問題 ${currentQuestionIndex + 1} / ${QUESTIONS_PER_SESSION}`;
        document.getElementById('score-text').textContent = `分數: ${score}`;

        const opt = document.getElementById('options-container');
        opt.innerHTML = '';

        shuffled.forEach(option => {
            const btn = document.createElement('button');
            btn.textContent = option;
            btn.className = 'w-full bg-indigo-500 text-white text-lg font-semibold py-3 rounded-lg';
            btn.onclick = () => checkAnswer(option, btn);
            opt.appendChild(btn);
        });
    }

    function showModal(title, message, success = true) {
        const modal = document.getElementById("message-modal");
        const modalTitle = document.getElementById("modal-title");
        const modalMessage = document.getElementById("modal-message");

        modalTitle.textContent = title;
        modalMessage.textContent = message;

        modalTitle.classList.remove("text-green-600", "text-red-600");
        modalTitle.classList.add(success ? "text-green-600" : "text-red-600");

        modal.classList.remove("hidden");
    }

    document.getElementById("modal-ok").onclick = function () {
        document.getElementById("message-modal").classList.add("hidden");
        currentQuestionIndex++;
        loadQuestion();
    };

    function checkAnswer(selectedOption, button) {
        const optionsContainer = document.getElementById('options-container');
        const currentQuestion = sessionQuestions[currentQuestionIndex];
        const isCorrect = selectedOption === currentQuestion.answer;

        Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);

        if (isCorrect) {
            score++;
            button.classList.add('bg-green-500');
            showModal("恭喜！", "答案正確！", true);
        } else {
            button.classList.add('bg-red-500');
            Array.from(optionsContainer.children).forEach(btn => {
                if (btn.textContent === currentQuestion.answer) btn.classList.add("bg-green-500");
            });
            showModal("錯誤", `正確答案是：${currentQuestion.answer}`, false);
        }
    }

    function formatTimestampASCII() {
        const now = new Date();
        return (
            now.getFullYear() + "-" +
            String(now.getMonth() + 1).padStart(2, "0") + "-" +
            String(now.getDate()).padStart(2, "0") + " " +
            String(now.getHours()).padStart(2, "0") + ":" +
            String(now.getMinutes()).padStart(2, "0") + ":" +
            String(now.getSeconds()).padStart(2, "0")
        );
    }

    function showResult() {
        const end = new Date();
        const secondsUsed = Math.round((end - startTime) / 1000);

        document.getElementById('quiz-container').classList.add('hidden');
        document.getElementById('result-container').classList.remove('hidden');

        document.getElementById('final-message').textContent = "測驗完成！";
            // 新增：顯示廠區、工號
    document.getElementById('final-site').textContent = `廠區：${siteValue}`;
    document.getElementById('final-id').textContent = `工號：${employeeId}`;
        document.getElementById('final-score-text').textContent = `最終分數：${score}`;
        document.getElementById('time-spent-text').textContent = `使用秒數：${secondsUsed} 秒`;

        const form = document.forms['quiz-results'];
        form.site.value = siteValue;
        form.employee_id.value = employeeId;
        form.score.value = score;
        form.time_spent.value = secondsUsed;
        form.timestamp.value = formatTimestampASCII();

        fetch("https://api.ipify.org?format=json")
            .then(r => r.json())
            .then(data => form.ip.value = data.ip)
            .finally(() => {
                fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(new FormData(form)).toString(),
                });
            });
    }

    function resetQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        sessionQuestions = shuffleArray(fullQuizData).slice(0, QUESTIONS_PER_SESSION);

        startTime = new Date();
        document.getElementById('quiz-container').classList.remove('hidden');
        document.getElementById('result-container').classList.add('hidden');

        loadQuestion();
    }
</script>

</body>
</html>




